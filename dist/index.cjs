"use strict";var b=Object.defineProperty;var E=(t,r,n)=>r in t?b(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var d=(t,r,n)=>E(t,typeof r!="symbol"?r+"":r,n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function y(t){const r={},n=t.$select;n&&(r.select=n.split(",").map(p=>p.trim()).filter(Boolean));const e=t.$orderby;e&&(r.orderby=e.split(",").map(p=>{const[w,S]=p.trim().split(/\s+/);return{property:w,direction:S?.toLowerCase()==="desc"?"desc":"asc"}}));const o=t.$top;o!==void 0&&(r.top=Math.max(0,Number(o)));const i=t.$skip;i!==void 0&&(r.skip=Math.max(0,Number(i)));const a=t.$count;a!==void 0&&(r.count=String(a).toLowerCase()==="true");const u=t.$filter;u&&(r.filter=u);const c=t.$expand;return c&&(r.expand=c.split(",").map(p=>({path:p.trim()}))),r}function N(t){return{before:async r=>{const n=r.event??{},e=n.rawQueryString?Object.fromEntries(new URLSearchParams(n.rawQueryString)):n.queryStringParameters||{},o=y(e),i=typeof t.serviceRoot=="function"?t.serviceRoot(n):t.serviceRoot,a={model:t.model,serviceRoot:i,entitySet:void 0,options:o};r.internal=r.internal||{},r.internal.odata=a}}}class s extends Error{constructor(){super(...arguments);d(this,"statusCode",400);d(this,"code","BadRequest")}}class m extends Error{constructor(){super(...arguments);d(this,"statusCode",500);d(this,"code","InternalServerError")}}function D(t,r){if(t&&typeof t=="object"&&"statusCode"in t&&"message"in t){const n=t;return{error:{code:n.code??String(n.statusCode),message:n.message}}}return{error:{code:"InternalServerError",message:r??"An error occurred"}}}function $(t,r,n){if(!t||t.length===0)return;const e=n.entityTypes?.find(i=>i.name===r);if(!e)throw new s(`Entity type '${r}' not found`);const o=e.properties?.map(i=>i.name)||[];for(const i of t)if(!o.includes(i))throw new s(`Property '${i}' not found in entity type '${r}'`)}function P(t,r,n){if(!t)return;if(t.includes("()"))throw new s("Invalid filter expression: empty parentheses");if(t.includes("  "))throw new s("Invalid filter expression: multiple spaces");let e=0;for(const c of t)if(c==="("&&e++,c===")"&&e--,e<0)throw new s("Invalid filter expression: unmatched closing parenthesis");if(e!==0)throw new s("Invalid filter expression: unmatched opening parenthesis");const o=n.entityTypes?.find(c=>c.name===r);if(!o)throw new s(`Entity type '${r}' not found`);const i=o.properties?.map(c=>c.name)||[],u=t.replace(/'[^']*'/g,"").match(/\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g)||[];for(const c of u)if(!["eq","ne","gt","ge","lt","le","and","or","not","true","false","null"].includes(c)&&!i.includes(c))throw new s(`Property '${c}' not found in entity type '${r}'`)}function x(t,r,n){if(!t||t.length===0)return;const e=n.entityTypes?.find(i=>i.name===r);if(!e)throw new s(`Entity type '${r}' not found`);const o=e.properties?.map(i=>i.name)||[];for(const i of t){const[a]=i.split(" ");if(!o.includes(a))throw new s(`Property '${a}' not found in entity type '${r}'`)}}function O(t,r,n){if(!t||t.length===0)return;const e=n.entityTypes?.find(i=>i.name===r);if(!e)throw new s(`Entity type '${r}' not found`);const o=e.navigation?.map(i=>i.name)||[];for(const i of t)if(!o.includes(i))throw new s(`Navigation property '${i}' not found in entity type '${r}'`)}function C(t,r,n){const e=n.entityTypes?.find(i=>i.name===r);if(!e)throw new s(`Entity type '${r}' not found`);const o=e.properties?.filter(i=>i.nullable!==!0)||[];for(const i of o)if(!(i.name in t)||t[i.name]===null||t[i.name]===void 0)throw new s(`Required property '${i.name}' is missing or null`);for(const i of e.properties||[])if(i.name in t){const a=t[i.name];if(a!=null){if(i.type==="Edm.String"&&typeof a!="string")throw new s(`Property '${i.name}' must be a string`);if((i.type==="Edm.Int32"||i.type==="Edm.Decimal")&&typeof a!="number")throw new s(`Property '${i.name}' must be a number`);if(i.type==="Edm.Boolean"&&typeof a!="boolean")throw new s(`Property '${i.name}' must be a boolean`)}}}function I(t){return t instanceof s?400:(t instanceof m,500)}function A(t){return t instanceof s}function M(t){return t instanceof m}function v(t,r){if(!r||r.length===0)return{...t};const n={};for(const e of r)e in t&&(n[e]=t[e]);return n}function R(t,r){return t.map(n=>v(n,r.select))}function g(t,r){if(!r.expand||r.expand.length===0)return t;if(Array.isArray(t))return t.map(e=>g(e,r));const n={...t};for(const e of r.expand){const o=e.path;if(o&&!(o in n)&&(n[o]=null),e.options){const i=n[o];i&&(n[o]=g(i,e.options))}}return n}function l(t){if(t.includes(" and ")){const n=h(t," and ");return{type:"logical",operator:"and",left:l(n[0].trim()),right:l(n[1].trim())}}if(t.includes(" or ")){const n=h(t," or ");return{type:"logical",operator:"or",left:l(n[0].trim()),right:l(n[1].trim())}}const r=[" eq "," ne "," gt "," ge "," lt "," le "];for(const n of r)if(t.includes(n)){const e=t.split(n);if(e.length===2)return{type:"comparison",operator:n.trim(),left:l(e[0].trim()),right:l(e[1].trim())}}if(t.includes("(")&&t.includes(")")){const n=t.match(/^(\w+)\((.+)\)$/);if(n){const[,e,o]=n,i=o.split(",").map(a=>l(a.trim()));return{type:"function",function:e,args:i}}}return t.startsWith("'")&&t.endsWith("'")?{type:"literal",value:t.slice(1,-1)}:t==="null"?{type:"literal",value:null}:isNaN(Number(t))?{type:"property",property:t}:{type:"literal",value:Number(t)}}function h(t,r){let n=0,e=!1;for(let o=0;o<t.length-r.length+1;o++){const i=t[o];if(i==="'"&&(e=!e),!e&&(i==="("&&n++,i===")"&&n--,n===0&&t.slice(o,o+r.length)===r))return[t.slice(0,o),t.slice(o+r.length)]}return[t]}function f(t,r){switch(t.type){case"property":return T(r,t.property);case"literal":return t.value;case"comparison":{const n=f(t.left,r),e=f(t.right,r);return B(n,t.operator,e)}case"logical":{const n=f(t.left,r),e=f(t.right,r);return j(n,t.operator,e)}case"function":return F(t.function,t.args,r);default:return!1}}function T(t,r){const n=r.split("/");let e=t;for(const o of n)if(e&&typeof e=="object")e=e[o];else return;return e}function B(t,r,n){switch(r){case"eq":return t===n;case"ne":return t!==n;case"gt":return t>n;case"ge":return t>=n;case"lt":return t<n;case"le":return t<=n;default:return!1}}function j(t,r,n){switch(r){case"and":return t&&n;case"or":return t||n;default:return!1}}function F(t,r,n){const e=r.map(o=>f(o,n));switch(t){case"contains":if(e.length>=2){const o=String(e[0]||""),i=String(e[1]||"");return o.includes(i)}return!1;case"startswith":if(e.length>=2){const o=String(e[0]||""),i=String(e[1]||"");return o.startsWith(i)}return!1;case"endswith":if(e.length>=2){const o=String(e[0]||""),i=String(e[1]||"");return o.endsWith(i)}return!1;case"length":return e.length>=1?String(e[0]||"").length:0;case"tolower":return e.length>=1?String(e[0]||"").toLowerCase():"";case"toupper":return e.length>=1?String(e[0]||"").toUpperCase():"";case"trim":return e.length>=1?String(e[0]||"").trim():"";case"substring":if(e.length>=2){const o=String(e[0]||""),i=Number(e[1])||0;if(e.length>=3){const a=Number(e[2])||0;return o.substring(i,i+a)}return o.substring(i)}return"";case"indexof":if(e.length>=2){const o=String(e[0]||""),i=String(e[1]||"");return o.indexOf(i)}return-1;case"concat":return e.map(o=>String(o||"")).join("");case"year":if(e.length>=1){const o=new Date(e[0]);return isNaN(o.getTime())?0:o.getFullYear()}return 0;case"month":if(e.length>=1){const o=new Date(e[0]);return isNaN(o.getTime())?0:o.getMonth()+1}return 0;case"day":if(e.length>=1){const o=new Date(e[0]);return isNaN(o.getTime())?0:o.getDate()}return 0;case"hour":if(e.length>=1){const o=new Date(e[0]);return isNaN(o.getTime())?0:o.getHours()}return 0;case"minute":if(e.length>=1){const o=new Date(e[0]);return isNaN(o.getTime())?0:o.getMinutes()}return 0;case"second":if(e.length>=1){const o=new Date(e[0]);return isNaN(o.getTime())?0:o.getSeconds()}return 0;case"round":return e.length>=1?Math.round(Number(e[0])||0):0;case"floor":return e.length>=1?Math.floor(Number(e[0])||0):0;case"ceiling":return e.length>=1?Math.ceil(Number(e[0])||0):0;case"now":return new Date().toISOString();case"maxdatetime":return new Date("9999-12-31T23:59:59.999Z").toISOString();case"mindatetime":return new Date("0001-01-01T00:00:00.000Z").toISOString();default:return!1}}function W(t,r){if(!r.filter)return t;try{const n=l(r.filter);return t.filter(e=>f(n,e))}catch(n){return console.warn("Filter parsing failed:",n),t}}function k(t,r){if(!r.orderby||r.orderby.length===0)return t;const n=[...t];return n.sort((e,o)=>{for(const i of r.orderby){const a=e[i.property],u=o[i.property];if(!(a==null&&u==null)){if(a==null)return i.direction==="asc"?-1:1;if(u==null)return i.direction==="asc"?1:-1;if(a<u)return i.direction==="asc"?-1:1;if(a>u)return i.direction==="asc"?1:-1}}return 0}),n}function L(t,r){const n=r.skip??0,e=r.top??t.length;return t.slice(n,n+e)}function Q(t,r,n,e){const o={"@odata.context":t,value:r};return typeof n=="number"&&(o["@odata.count"]=n),e&&(o["@odata.nextLink"]=e),o}exports.ODataBadRequest=s;exports.ODataInternalServerError=m;exports.applySelect=v;exports.expandData=g;exports.filterArray=W;exports.getHttpStatusCode=I;exports.isServerError=M;exports.isValidationError=A;exports.odata=N;exports.orderArray=k;exports.paginateArray=L;exports.parseODataQuery=y;exports.projectArray=R;exports.serializeCollection=Q;exports.toODataError=D;exports.validateEdmModelConstraints=C;exports.validateExpandNavigationProperties=O;exports.validateFilterExpression=P;exports.validateOrderByProperties=x;exports.validateSelectParameters=$;
//# sourceMappingURL=index.cjs.map
