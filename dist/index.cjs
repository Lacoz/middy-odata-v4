"use strict";var b=Object.defineProperty;var v=(t,n,r)=>n in t?b(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;var f=(t,n,r)=>v(t,typeof n!="symbol"?n+"":n,r);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function m(t){const n={},r=t.$select;r&&(n.select=r.split(",").map(l=>l.trim()).filter(Boolean));const e=t.$orderby;e&&(n.orderby=e.split(",").map(l=>{const[y,S]=l.trim().split(/\s+/);return{property:y,direction:S?.toLowerCase()==="desc"?"desc":"asc"}}));const a=t.$top;a!==void 0&&(n.top=Math.max(0,Number(a)));const o=t.$skip;o!==void 0&&(n.skip=Math.max(0,Number(o)));const s=t.$count;s!==void 0&&(n.count=String(s).toLowerCase()==="true");const c=t.$filter;c&&(n.filter=c);const p=t.$expand;return p&&(n.expand=p.split(",").map(l=>({path:l.trim()}))),n}function N(t){return{before:async n=>{const r=n.event??{},e=r.rawQueryString?Object.fromEntries(new URLSearchParams(r.rawQueryString)):r.queryStringParameters||{},a=m(e),o=typeof t.serviceRoot=="function"?t.serviceRoot(r):t.serviceRoot,s={model:t.model,serviceRoot:o,entitySet:void 0,options:a};n.internal=n.internal||{},n.internal.odata=s}}}class D extends Error{constructor(){super(...arguments);f(this,"statusCode",400);f(this,"code","BadRequest")}}class w extends Error{constructor(){super(...arguments);f(this,"statusCode",500);f(this,"code","InternalServerError")}}function O(t,n){if(t&&typeof t=="object"&&"statusCode"in t&&"message"in t){const r=t;return{error:{code:r.code??String(r.statusCode),message:r.message}}}return{error:{code:"InternalServerError",message:n??"An error occurred"}}}function h(t,n){if(!n||n.length===0)return{...t};const r={};for(const e of n)e in t&&(r[e]=t[e]);return r}function x(t,n){return t.map(r=>h(r,n.select))}function g(t,n){if(!n.expand||n.expand.length===0)return t;if(Array.isArray(t))return t.map(e=>g(e,n));const r={...t};for(const e of n.expand){const a=e.path;if(a&&!(a in r)&&(r[a]=null),e.options){const o=r[a];o&&(r[a]=g(o,e.options))}}return r}function i(t){if(t.includes(" and ")){const r=d(t," and ");return{type:"logical",operator:"and",left:i(r[0].trim()),right:i(r[1].trim())}}if(t.includes(" or ")){const r=d(t," or ");return{type:"logical",operator:"or",left:i(r[0].trim()),right:i(r[1].trim())}}const n=[" eq "," ne "," gt "," ge "," lt "," le "];for(const r of n)if(t.includes(r)){const e=t.split(r);if(e.length===2)return{type:"comparison",operator:r.trim(),left:i(e[0].trim()),right:i(e[1].trim())}}if(t.includes("(")&&t.includes(")")){const r=t.match(/^(\w+)\((.+)\)$/);if(r){const[,e,a]=r,o=a.split(",").map(s=>i(s.trim()));return{type:"function",function:e,args:o}}}return t.startsWith("'")&&t.endsWith("'")?{type:"literal",value:t.slice(1,-1)}:t==="null"?{type:"literal",value:null}:isNaN(Number(t))?{type:"property",property:t}:{type:"literal",value:Number(t)}}function d(t,n){let r=0,e=!1;for(let a=0;a<t.length-n.length+1;a++){const o=t[a];if(o==="'"&&(e=!e),!e&&(o==="("&&r++,o===")"&&r--,r===0&&t.slice(a,a+n.length)===n))return[t.slice(0,a),t.slice(a+n.length)]}return[t]}function u(t,n){switch(t.type){case"property":return A(n,t.property);case"literal":return t.value;case"comparison":const r=u(t.left,n),e=u(t.right,n);return C(r,t.operator,e);case"logical":const a=u(t.left,n),o=u(t.right,n);return E(a,t.operator,o);case"function":return R(t.function,t.args,n);default:return!1}}function A(t,n){const r=n.split("/");let e=t;for(const a of r)if(e&&typeof e=="object")e=e[a];else return;return e}function C(t,n,r){switch(n){case"eq":return t===r;case"ne":return t!==r;case"gt":return t>r;case"ge":return t>=r;case"lt":return t<r;case"le":return t<=r;default:return!1}}function E(t,n,r){switch(n){case"and":return t&&r;case"or":return t||r;default:return!1}}function R(t,n,r){const e=n.map(a=>u(a,r));switch(t){case"contains":if(e.length>=2){const a=String(e[0]||""),o=String(e[1]||"");return a.includes(o)}return!1;case"startswith":if(e.length>=2){const a=String(e[0]||""),o=String(e[1]||"");return a.startsWith(o)}return!1;case"endswith":if(e.length>=2){const a=String(e[0]||""),o=String(e[1]||"");return a.endsWith(o)}return!1;case"length":return e.length>=1?String(e[0]||"").length:0;case"tolower":return e.length>=1?String(e[0]||"").toLowerCase():"";case"toupper":return e.length>=1?String(e[0]||"").toUpperCase():"";case"trim":return e.length>=1?String(e[0]||"").trim():"";case"substring":if(e.length>=2){const a=String(e[0]||""),o=Number(e[1])||0;if(e.length>=3){const s=Number(e[2])||0;return a.substring(o,o+s)}return a.substring(o)}return"";case"indexof":if(e.length>=2){const a=String(e[0]||""),o=String(e[1]||"");return a.indexOf(o)}return-1;case"concat":return e.map(a=>String(a||"")).join("");case"year":if(e.length>=1){const a=new Date(e[0]);return isNaN(a.getTime())?0:a.getFullYear()}return 0;case"month":if(e.length>=1){const a=new Date(e[0]);return isNaN(a.getTime())?0:a.getMonth()+1}return 0;case"day":if(e.length>=1){const a=new Date(e[0]);return isNaN(a.getTime())?0:a.getDate()}return 0;case"hour":if(e.length>=1){const a=new Date(e[0]);return isNaN(a.getTime())?0:a.getHours()}return 0;case"minute":if(e.length>=1){const a=new Date(e[0]);return isNaN(a.getTime())?0:a.getMinutes()}return 0;case"second":if(e.length>=1){const a=new Date(e[0]);return isNaN(a.getTime())?0:a.getSeconds()}return 0;case"round":return e.length>=1?Math.round(Number(e[0])||0):0;case"floor":return e.length>=1?Math.floor(Number(e[0])||0):0;case"ceiling":return e.length>=1?Math.ceil(Number(e[0])||0):0;case"now":return new Date().toISOString();case"maxdatetime":return new Date("9999-12-31T23:59:59.999Z").toISOString();case"mindatetime":return new Date("0001-01-01T00:00:00.000Z").toISOString();default:return!1}}function M(t,n){if(!n.filter)return t;try{const r=i(n.filter);return t.filter(e=>u(r,e))}catch(r){return console.warn("Filter parsing failed:",r),t}}function T(t,n){if(!n.orderby||n.orderby.length===0)return t;const r=[...t];return r.sort((e,a)=>{for(const o of n.orderby){const s=e[o.property],c=a[o.property];if(!(s==null&&c==null)){if(s==null)return o.direction==="asc"?-1:1;if(c==null)return o.direction==="asc"?1:-1;if(s<c)return o.direction==="asc"?-1:1;if(s>c)return o.direction==="asc"?1:-1}}return 0}),r}function I(t,n){const r=n.skip??0,e=n.top??t.length;return t.slice(r,r+e)}function $(t,n,r,e){const a={"@odata.context":t,value:n};return typeof r=="number"&&(a["@odata.count"]=r),e&&(a["@odata.nextLink"]=e),a}exports.ODataBadRequest=D;exports.ODataInternalServerError=w;exports.applySelect=h;exports.expandData=g;exports.filterArray=M;exports.odata=N;exports.orderArray=T;exports.paginateArray=I;exports.parseODataQuery=m;exports.projectArray=x;exports.serializeCollection=$;exports.toODataError=O;
//# sourceMappingURL=index.cjs.map
